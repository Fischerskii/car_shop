# CarShop

Приложение автосалона. Позволяет создавать базу автомобилей с описанием характеристик. Есть 3 роли пользователей с различными правами доступа на действия над автомобилями.

## Особенности

- **Аудит логов**: Записывает время выполнения и действия, выполненные в методах или классах, аннотированных `@Audit`.
- **Операции с базой данных**: Управляет CRUD-операциями для сущностей `Car`, `Order` и `User` с использованием JDBC.
- **HTTP API**: Предоставляет REST-подобные API для управления заказами и пользователями.
- **Аутентификация на основе JWT**: Защищает API эндпоинты с использованием JWT токенов с ролевым контролем доступа.
- **Миграция базы данных**: Управляет обновлениями схемы базы данных с помощью Liquibase.

## Содержание

1. [Разворачивание БД в Docker](#разворачивание-бд-в-docker)
2. [Миграция данных](#миграция-данных-liquibase)
3. [Взаимодействие с приложением](#взаимодействие-с-приложением)
4. [Логирование и аудит](#логирование-и-аудит)
5. [Аутентификация и авторизация](#аутентификация-и-авторизация)

## Разворачивание БД в Docker

log/pass: car_shop_user/password
-  Для развертывания postgres БД нужно запустить команду docker-compose up -d
   Команда запускает контейнер с запущенной БД и использует логин и пароль указанные в переменных среды
- После разворачивания контейнера можно подключиться к БД по JDBC URL:
  jdbc:postgresql://localhost:5432/car_shop_db

## Миграция данных Liquibase

Миграция выполняется при старте приложения путём вызова `LiquibaseRunner`-ом конфигурационного файла `changelog.xml`, размещенного в ресурсах проекта.

Переменные вынесены в файл `application.properties`, содержащий:
- url для коннекта с БД
- логин БД
- пароль БД
- путь до главного файла миграции `changelog.xml`

Главный файл вызывает файлы миграции для создания таблиц, создания sequence и предзаполнения данными.

## Взаимодействие с приложением

### API Эндпоинты

Приложение предоставляет несколько REST-подобных API эндпоинтов:

#### Заказы: `/api/orders`
- **GET** `/api/orders`: Получить все заказы.
- **GET** `/api/orders/{id}`: Получить заказ по ID.
- **POST** `/api/orders`: Создать новый заказ.
- **PUT** `/api/orders/{id}`: Обновить статус существующего заказа.

#### Пользователи: `/api/users`
- **GET** `/api/users`: Получить всех пользователей.
- **GET** `/api/users/{username}`: Получить пользователя по имени.
- **POST** `/api/users/register`: Зарегистрировать нового пользователя.
- **POST** `/api/users/login`: Войти в систему и получить JWT токен.
- **POST** `/api/users/logout`: Выйти из системы и аннулировать JWT токен.

#### Автомобили: `/api/cars`
- **GET** `/api/cars`: Получить список всех автомобилей.
- **GET** `/api/cars/{vin}`: Получить авто по VIN.
- **POST** `/api/cars`: Создать новый авто.
- **PUT** `/api/cars/{vin}`: Отредактировать авто.
- **DELETE** `/api/cars/{vin}`: Удалить авто.

## Логирование и Аудит

### Аудит Логов

Методы, аннотированные `@Audit`, автоматически логируются, записывая время выполнения и детали действий.

### Логи

Логи приложения записываются с использованием `Slf4j` и могут быть настроены в файле `logback.xml`.

## Аутентификация и Авторизация

### JWT

Приложение использует JWT токены для защиты API эндпоинтов. После входа в систему включите JWT токен в заголовок `Authorization` в последующих запросах как `Bearer {token}`.
